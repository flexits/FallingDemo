## FallingDemo
### СибГУТИ - Программирование мобильных устройств - Лабораторная работа 3
Задание: Реализуйте прыгающий <объект>. Начальная позиция появления объекта определяется нажатием пальца по экрану. Объект падает с ускорением вниз, отражаясь от нижней границы экрана, и с незначительным смешением вправо. С каждым разом высота отскока объекта уменьшается, и когда объект практически остановится, он пропадает с экрана. Объектов может быть несколько, поэтому каждый должен обрабатываться в отдельном потоке приложения. (<объект> - Буква Вашей фамилии, после каждого нажатия буква меняется на следующую, по окончанию Вы опять возвращаетесь на первую букву).

![fd](https://user-images.githubusercontent.com/86118729/194913488-98230261-de9b-42bc-a049-8f7e0a1ff8fd.png | height=320)

Интерфейс приложения состоит из единственного Activity (MainActivity), который использует отдельно созданный визуальный интерфейс DrawView для рисования падающих объектов на экране. Для рисования применён отдельный поток, работающий с canvas. Он запускается при создании поверхности и содержит внутри себя цикл, который итерирует коллекцию объектов, выводит на экран букву, соответствующую имени объекта в координатах, заданных в соответствующем поле объекта, и завершает свою работу.  Между итерациями этого цикла предусмотрена пауза для ограничения FPS и, следовательно, нагрузки на систему.

Падающий объект описывается классом FallingEntity. Каждый объект имеет определённые координаты и имя (в данном случае – буква алфавита). Также в классе определена реализация интерфейса Runnable, где определяется механика движения. Соответствующим методом (void startMovement(Rect display)) экземпляра класса запускается отдельный поток, в котором и происходит перемещение объекта (т.е. вычисление новых координат) в цикле. Цикл перемещения объекта контролируется флагом – переменной, и может быть прерван методом void stopMovement(), соответственно будет завершён и поток. Кроме того, класс определяет флаг состояния, который будет установлен после того, как объект упадёт и движение его остановится – такие объекты больше не отрисовываются на экране и подлежат удалению. Остановка объекта приводит к завершению соответствующего потока. 

В основном Activity обрабатывается событие касания и вызывается статический метод класса – фабрики объектов EntitiesFactory. GenerateAt(PointF coordinates), возвращающий очередной объект с первоначальными координатами, соответствующими точке отпускания касания. 
Хранилище объектов реализовано с использованием ViewModel (класс MainViewModel), аналогично предыдущей лабораторной работе. В хранилище заключен объект MutableLiveData, хранящий коллекцию CopyOnWriteArrayList. Отличительной особенностью данной коллекции является возможность одновременного итерирования и изменения, таким образом, обеспечивается возможность удалять и добавлять элементы коллекции одновременно с их отрисовкой. Как показано ранее, добавление объекта происходит при касании экрана. Основной Activity запускает отдельный поток, который периодически очищает хранилище от уже остановившихся и более ненужных объектов. 
